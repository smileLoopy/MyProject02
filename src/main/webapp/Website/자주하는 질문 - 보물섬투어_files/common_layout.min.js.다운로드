/***********************************************************************************
* divice reaction
* ready, scroll, addEventListener(load), addEventListener(resize), mobile
***********************************************************************************/
function test_scroll_event() {
	var scroll_top = $(window).scrollTop();
	var body_h = $("#wrap").height();
	var header_h = $("#header").height();
	var gnb1_h = $(".gnb1").height();
	var gnb2_h = $(".gnb2").height();
	var gnb3_h = $(".gnb3").height();
	var container_h = $("#container").height();
	var footer_h = $("#footer").height(); 
	var navi_h = $(".remote_quicknavi").height();
	var point_top = body_h - navi_h - footer_h - 30;  // -30:보정값
	
	str = "";
	str += "scroll = "+ scroll_top +"<br>";
	str +="body = "+ body_h +"<br>";
	str += "header = "+ header_h +"<br>";
//	str += "footer = "+ footer_h +"<br>";  
//	str += "gnb1 = "+ gnb1_h +"<br>";
//	str += "gnb2 = "+ gnb2_h +"<br>";
//	str += "gnb3 = "+ gnb3_h +"<br>";
//	str += "cont = "+ container_h +"<br>";
	str += "navi_h = "+ navi_h +"<br>";
	str += "point = "+ point_top +"<br>";
	//$(".debug").html(str);
}
//dfefault onload reaction
$(document).ready(function() {
		test_scroll_event();
		patch_autocomplete(); //jquery-byul-ui
		search_autocomplete(); //jquery-byul-ui
		reaction_header(); //header navigation
		reservation_quicknavi();
		join_quicknavi();
		//$(".snb_left").load("/_inc/header_snb_left.asp");
		//snb_left(); //side navigation
		$(".snb_right").load("/_inc/header_snb_right.asp");
		snb_right(); //side navigation
});
//divice scroll reaction
$(window).scroll(function() { 
		test_scroll_event();
		reaction_header(); //header navigation
		reservation_quicknavi();
		join_quicknavi();
		//snb_left(); //side navigation
		snb_right(); //side navigation
});
//divice resize reaction
if(msie8Less == "no") {
	window.addEventListener("resize", function() {	
		test_scroll_event();
		patch_autocomplete(); //jquery-byul-ui
		search_autocomplete(); //jquery-byul-ui
		reaction_header(); //side navigation
		//snb_left(); //side navigation
		snb_right(); //side navigation
	});
}
/**********************************************************************************
* keyCodeEvent(ESC)
***********************************************************************************/
$(window).keydown(function(event) {
	//alert(event.keyCode);
	keyCodeEvent(event.keyCode);
});
function keyCodeEvent(keycode) {
	if(keycode == '27') { // close modal "esc" click
		allmenu_close();
		GoSearchToggle_close();
		snb_right_action("off");
		//====================
		//modal_close
		$("#modal").hide();
		modal_in_close()
		//====================
	}
}
/***********************************************************************************
* gnb3 - allmemu_toggle
***********************************************************************************/
function allmemu_toggle() {
	var val = $(".allmenu_box").attr("val");
	if(val == "N") { allmenu_open(); } 
	if(val == "Y") { allmenu_close(); }
	return false;
}
function allmenu_open() { 
	$(".gnb3 .menu_box ul li.allmenu .gnb3_btn").removeClass('gnb3_allmenu');
	$(".gnb3 .menu_box ul li.allmenu .gnb3_btn").addClass('gnb3_close');
	$(".gnb3 .menu_box ul li.allmenu").addClass('close');
	$(".allmenu_box").show();
	$(".allmenu_box").attr('val', 'Y');
	//ajaxGetPage(".allmenu_box .gnb3_allmenu", "/_inc/header_gnb3_allmenu.asp");
	$(".allmenu_box .gnb3_allmenu").load("/_inc/header_gnb3_allmenu.asp");
	GoSearchToggle_close();
	return false;
}
function allmenu_close() {
	$(".gnb3 .menu_box ul li.allmenu .gnb3_btn").addClass('gnb3_allmenu');
	$(".gnb3 .menu_box ul li.allmenu .gnb3_btn").removeClass('gnb3_close');
	$(".gnb3 .menu_box ul li.allmenu").removeClass('close');
	$(".allmenu_box").hide();
	$(".allmenu_box").attr('val', 'N');
	$(".allmenu_box .gnb3_allmenu").html("");
	return false;
}
/***********************************************************************************
* gnb3 - search_toggle
***********************************************************************************/
function GoSearchPage(frm) { //serarch page
	if(keywordstrCheck(frm.searchKeyword) == false) return false; //common_check.js
	if ( check_value(frm.searchKeyword, "검색어를 입력해주세요") ) return false;
	if ( frm.searchKeyword.value.length==1) {
		modal_alert('2글자 이상 입력하세요');
		frm.searchKeyword.focus();
		return false;
	}
	frm.method="get";
	frm.action="/search/search.asp";
	frm.submit();
}
//function searchTopKeyword(keyword) {
//	var frm = document.FrmSearchTop;
//	$("#searchTopKeyword").val(keyword);
//	frm.method="get";
//	frm.action="/search/search.asp";
//	frm.submit();
//}
function searchpageKeyword(keyword) {
	var frm = document.FrmSearchpage;
	$("#searchPageKeyword").val(keyword);
	frm.method="get";
	frm.action="/search/search.asp";
	frm.submit();
}
//function GoSearchTop(frm) { //top serarch
//	frm.method="get";
//	frm.action="/search/search.asp";
//	frm.submit();
//}
function GoSearchToggle(frm) { //gnb3 & search page
	frm.method="get";
	frm.action="/search/search.asp";
	frm.submit();
}
// Search toggle
function GoSearch_toggle(searchKeyWord) {
	if(searchKeyWord == "") {
		var val = $(".SearchToggle_box").attr("val");
		if(val == "N") { GoSearchToggle_open(); } 
		if(val == "Y") { GoSearchToggle_close(); }
	} else { //now serarh page
		$(".SearchToggle_box").hide();
		$("#searchPageKeyword").focus();
	}
	return false;
}
function GoSearchToggle_open() { 
	$(".gnb3 .menu_box ul li.topsearch .gnb3_btn").removeClass('gnb3_allmenu');
	$(".gnb3 .menu_box ul li.topsearch .gnb3_btn").addClass('gnb3_close');
	$(".gnb3 .menu_box ul li.topsearch").addClass('close');
	$(".SearchToggle_box").show();
	$(".SearchToggle_box").attr('val', 'Y');
	$("#searchPageKeyword").focus();
	allmenu_close();
	return false;
}
function GoSearchToggle_close() {
	$(".gnb3 .menu_box ul li.topsearch .gnb3_btn").addClass('gnb3_allmenu');
	$(".gnb3 .menu_box ul li.topsearch .gnb3_btn").removeClass('gnb3_close');
	$(".gnb3 .menu_box ul li.topsearch").removeClass('close');

	$(".SearchToggle_box").hide();
	$(".SearchToggle_box").attr('val', 'N');
	return false;
}

/***********************************************************************************
* gnb3 - scrolling reaction
***********************************************************************************/
function reaction_header() {

	var scroll_top = $(window).scrollTop();
	var header_h = $("#header").height()  + 20;
	//intro page 제외
	//document.write(_thisurl);http://www.bomultour.com/
	if (_thisurl != "http://www.bomultour.com/") { 
		// .gnb3만 적용시(2017-05-23)
		if($('#product_remote_quicknavi').hasClass('remote_quicknavi') == true) { //product page

			if(scroll_top > header_h) { //scroll down
				//modal_alert("1");
				$("#header .gnb3").css('position', 'fixed');
				$("#header .gnb3").css('top', 0);
				$("#header .gnb3").css('z-index', 9990);
				$(".tour_category_bg").css('position', 'fixed');
				$(".tour_category_bg").css('top', 83);
				$(".tour_category_bg").css('z-index', 9700);
				//allmenu_close();
				//GoSearchToggle_close();
			} else {
				//modal_alert("2");
				$("#header .gnb3").css('position', 'relative');
				$("#header .gnb3").css('z-index', '');
		//		$(".directory").css('position', 'relative');
		//		$(".directory").css('top', '-21px'); //반응형적용 제외시 css에 top 보정 적용
				$(".tour_category").css('position', 'relative');
				$(".tour_category").css('top', 0);
				$(".tour_category").css('z-index', 20);
				$(".tour_category_bg").css('position', 'absolute');
				$(".tour_category_bg").css('top', '');
				$(".tour_category_bg").css('z-index', 10);
			}

		} else {
			$('.sns_pack').addClass('on');
			if(scroll_top > header_h) { //scroll down
				//modal_alert("3");
				$("#header .gnb3").css('position', 'fixed');
				$("#header .gnb3").css('top', 0);
				$("#header .gnb3").css('z-index', 9990);
				$(".tour_category").css('position', 'fixed');
				$(".tour_category").css('top', 41);
				$(".tour_category").css('z-index', 9800);
				$(".tour_category_bg").css('position', 'fixed');
				$(".tour_category_bg").css('top', 83);
				$(".tour_category_bg").css('z-index', 9700);

				//allmenu_close();
				//GoSearchToggle_close();
			} else {
				//modal_alert("4");
				$("#header .gnb3").css('position', 'relative');
				$("#header .gnb3").css('z-index', '');
		//		$(".directory").css('position', 'relative');
		//		$(".directory").css('top', '-21px'); //반응형적용 제외시 css에 top 보정 적용
				$(".tour_category").css('position', 'relative');
				$(".tour_category").css('top', 0);
				$(".tour_category").css('z-index', 20);
				$(".tour_category_bg").css('position', 'absolute');
				$(".tour_category_bg").css('top', '');
				$(".tour_category_bg").css('z-index', 10);
			}
		}
	}
}

function reservation_quicknavi() {
	var scroll_top = $(window).scrollTop();
	var body_h = $("body").height();
	var header_h = $("#header").height() + $(".tnb_reserv").height(); //145, 40
	var footer_h = $("#footer").height(); 
	var navi_h = $(".remote_reservnavi").height();
	var point_top = body_h - navi_h - footer_h - 20;  // -50:보정값

	if(scroll_top > header_h && scroll_top <= point_top) {
		$(".remote_reservnavi").css('position', 'fixed');
		$(".remote_reservnavi").css('top', 20); // -50:보정값
	} else if(scroll_top > point_top) {
		$(" .remote_reservnavi").css('top', point_top - scroll_top);
	} else {
		$(".remote_reservnavi").css('position', 'relative');
		$(".remote_reservnavi").css('top', 0);
	}
}

function join_quicknavi() {
	var scroll_top = $(window).scrollTop();
	var header_h = $("#header").height(); //145, 40
	var footer_h = $("#footer").height(); 

	if(scroll_top > header_h) {
		$(".remote_joinnavi").addClass('on');
	} else {
		$(".remote_joinnavi").removeClass('on');
	}
}
/*===================================================================================
* Side Navigation bar
* scrolling reaction
===================================================================================*/
function snb_right() {
	var scroll_top = $(window).scrollTop();
	var header_h = 0;
	var default_h = 0;
	header_h = header_h + $("#header").height(); //default
	header_h = header_h + $(".area_1").height(); //main_promotion_top
	header_h = header_h + $(".tour_category").height(); //overseas category
	header_h = header_h + $(".remote_quicklink").height(); //product.asp
	header_h = header_h + $(".company .tnb_com").height(); //company tnb_com

	default_h = default_h + $("#header .gnb3").height();
	default_h = default_h + $(".categorybox ul li").height();
	default_h = default_h + $(".remote_quicklink").height();
	if($('#product_remote_quicknavi').hasClass('remote_quicknavi') == true) { //product page
		default_h = default_h - $(".categorybox ul li").height();
	}
	/*
	if (getCookie("pop_banner_header") == "done") { //case hide
		header_h = header_h - $("#pop_banner_header").height();
		default_h = default_h - $("#pop_banner_header").height();
	}
	*/
	if(scroll_top > header_h) { //scroll down
		//modal_alert("main_scroll");
		$('.snb_right').css('top', default_h + 10);
		$('.snb_right').css('position', 'fixed');
	} else {
		//modal_alert("main_scroll_none="+header_h);
		$('.snb_right').css('top', header_h + 10);
		$('.snb_right').css('position', 'absolute');
	}
}
function snb_right_action(val) {
	if(val == "on") {
		$(".snb_right").removeClass('off').addClass('on').css('right',0);
		$('.snb_right .btn span').removeClass('btn_ui_white ui-icon-carat-1-w');
		$('.snb_right .btn span').addClass('btn_ui_white ui-icon-carat-1-e');
		//$('.snb_right .btn span').addClass('btn_ui_white ui-icon-close');
	}
	if(val == "off") {
		$(".snb_right").removeClass('on').addClass('off').css('right', -120);
		$('.snb_right .btn span').removeClass('btn_ui_white ui-icon-carat-1-e');
		//$('.snb_right .btn span').removeClass('btn_ui_white ui-icon-close');
		$('.snb_right .btn span').addClass('btn_ui_white ui-icon-carat-1-w');
	}
}
function snb_right_onoff() {
	if($(".snb_right").hasClass('on') == true) {
		snb_right_action('off');
	} else {
		snb_right_action('on');
	}
}
function snb_left() {
	var header_h = 0;
	header_h = header_h + $("#header").height(); //default
	header_h = header_h + $(".area_1").height(); //main_promotion_top
	header_h = header_h + $(".category").height() + $(".category2_bg").height() + $(".category3_bg").height(); //여행상품 category
	header_h = header_h + $(".remote_quicklink").height(); //product.asp
	header_h = header_h + $(".company .tnb_com").height(); //company tnb_com
	header_h = header_h + 20; //add
	$('.snb_left').css('top', header_h);
}
/*==========================================================================
//Gnb3 Category navigation
//2016-11-02, 승철
==========================================================================*/
function gnb3_category_navi(cid) {

	$('.cid1_'+cid.substring(0,10)).addClass('on');
	$('.cid2_'+cid.substring(0,13)).addClass('on');
	$('.cid3_'+cid.substring(0,16)).addClass('on');
 	$('.categorybox ul li').hover(function(e) {
		var cate2_height = $('.category2:first',this).height() + $('.tour_category').height() +1;
		$('.tour_category_bg').css('height',cate2_height);
		$('.tour_category_bg').addClass('on');
		$('.category2:first',this).addClass('on'); 
	}, function() {
		$('.category2:first',this).removeClass('on');
		$('.tour_category_bg').removeClass('on');
	});
	/*
	//category width devide
	depth2_cnt = $('.categorybox ul').find('li.depth2').length;
	depth2_width = 1000 / depth2_cnt;
	//depth2_width = Math.floor(depth2_width).toFixed(0)-1;
	$('.categorybox ul li').css('width', depth2_width);
	*/

}
/*
function gnb3_category_bg(cid) {
	$('.categorybox ul li').hover(function(e) {
		var cate2_height = $('.category2',this).height();
		if(cate2_height > 40 && cate2_height <= 80) {
			$('.category2_bg').css('height',80);
			$('.category2_bg.on').css('height',80);
		} else if(cate2_height > 80) {
			$('.category2_bg').css('height',120);
			$('.category2_bg.on').css('height',120);
		} else {
			$('.category2_bg').css('height',50);
			$('.category2_bg.on').css('height',50);
		}
		//get cateory4 length
		depth4_check = $('.category3.cid3_'+cid.substring(0,13)+'.on',this).find('p').length;
		if(depth4_check == 0) {
			$('.category3_bg').removeClass('on');
		}
	}, function() {
		gnb3_category_navi(cid);
	});
}
function gnb3_category_navi(cid) {
 
	var cate2_height = $('.cid1_'+cid.substring(0,10)+' .category2').height();
	//alert(cate2_height);
	if(cate2_height > 40 && cate2_height <= 80) {
		$('.category2_bg').css('height',80);
		$('.category2_bg.on').css('height',80);
		$('.category3').css('margin-top',45);
	} else if(cate2_height > 80) {
		$('.category2_bg').css('height',120);
		$('.category2_bg.on').css('height',120);
		$('.category3').css('margin-top',85);
	} else {
		$('.category2_bg').css('height',50);
		$('.category2_bg.on').css('height',50);
		$('.category3').css('margin-top',15);
	}

	var cid_len = cid.length; 
	//cid2
	if(cid_len== 7) { //local.asp
		$('.categorybox ul li').hover(function(e) {
			$('.category2:first',this).addClass('on'); 
			$('.category2_bg').addClass('on');
		}, function() {
			$('.category2:first',this).removeClass('on');
			$('.category2_bg').removeClass('on');
		});
	}
	//cid3
	if(cid_len == 10) { //local.asp
		$('.categorybox ul li').hover(function(e) {
			$('.cid1_'+cid+' .category2').removeClass('on');
			$('.category2:first',this).addClass('on');
		}, function() {
			$('.category2:first',this).removeClass('on');
			$('.cid1_'+cid+' .category2').addClass('on');
			$('.category2_bg').addClass('on');
		});
		$('.cid1_'+cid+' .category2').addClass('on'); //cate2
		$('.category2_bg').addClass('on');
		$('.cid1_'+cid).addClass('on'); //cate1
	} 

	if(cid_len == 13) { //local.asp
		$('.categorybox ul li').hover(function(e) {
			$('.cid1_'+cid.substring(0,10)+' .category2').removeClass('on');
			$('.category2:first',this).addClass('on');
		}, function() {
			$('.category2:first',this).removeClass('on');
			$('.cid1_'+cid.substring(0,10)+' .category2').addClass('on');
			$('.category2_bg').addClass('on');
		$('.cid1_'+cid.substring(0,10)+' .category2').addClass('on');
		$('.category2_bg').addClass('on');
		$('.category3_bg').addClass('on');
		$('.cid1_'+cid.substring(0,10)).addClass('on');
		$('.cid2_'+cid).addClass('on');
		$('.cid3_'+cid).addClass('on');

		});
	} 

	if(cid_len == 16) { //local.asp
		$('.categorybox ul li').hover(function(e) {
			$('.cid1_'+cid.substring(0,10)+' .category2').removeClass('on');
			$('.category2:first',this).addClass('on');
		}, function() {
			$('.category2:first',this).removeClass('on');
			$('.cid1_'+cid.substring(0,10)+' .category2').addClass('on');
			$('.category2_bg').addClass('on');
		});
		$('.cid1_'+cid.substring(0,10)+' .category2').addClass('on');
		$('.category2_bg').addClass('on');
		$('.category3_bg').addClass('on');
		$('.cid1_'+cid.substring(0,10)).addClass('on');
		$('.cid2_'+cid.substring(0,13)).addClass('on');
		$('.cid3_'+cid.substring(0,13)).addClass('on');
		$('.cid3_'+cid).addClass('on');
	} 

	//sliser hide
	if(cid_len >= 13) {
		$('.area_3').hide();
	} 

	//category width devide
	depth2_cnt = $('.categorybox ul').find('li.depth2').length;
	depth2_width = 1000 / depth2_cnt;
	//depth2_width = Math.floor(depth2_width).toFixed(0)-1;
	depth2_width = depth2_width.toFixed(0)-2;
	$('.categorybox ul li').css('width', depth2_width);
	for(i=1; i <= depth2_cnt; i++) {
		var depth2_margin = - depth2_width * (i-1)
		$('.categorybox ul li div.category2.left_'+i).css('margin-left', depth2_margin);
	}
	//get cateory4 length
	depth4_check = $('.category3.cid3_'+cid.substring(0,13)+'.on').find('p').length;
	if(depth4_check == 0) {
		$('.category3_bg').removeClass('on');
	}
}
*/
